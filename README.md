# Yosegi - Pyramid (Geo)Parquet Generator

Yosegi is a tool to generate Pyramid (Geo)Parquet files - optimized for streaming large geospatial datasets.

## Usage

```bash
pip install yosegi
yosegi input.shp output.parquet --minzoom 0 --maxzoom 14
```

## Overview of Pyramid (Geo)Parquet

### Concept

- Pre-calculate which features are visible at each zoomlevel.
- Pre-calculate quadkey for each feature.
- Sort features by zoomlevel and quadkey.

Then, we can query like below:

```sql
SELECT * FROM yosegi
  WHERE zoomlevel = 10
    AND quadkey LIKE '133002110%'
```

### Benefits

- Single Parquet can be used for storing data and streaming.
- We can get overview of entire data quickly much faster than by only ordinary spatial sort like quadkey or Hilbert curve.
- Thanks to very efficient pushdown filtering by zoomlevel and quadkey, we can read partial content of large Parquet files quickly.

### Why quadkey?

- Hilbert curve is good for spatial locality but hierarchical query is not efficient. quadkey `LIKE` query is more efficient for pushdown filtering.
- The index generated by `ST_Hilbert` function of DuckDB is not consistent, values depends on bbox.

### Why not Tiles?

- Since creating a tileset exclusively for streaming is painful, it is better to support streaming directly from the original file.
- Lower zoom tiles are wasted when higher zoom levels are shown.
- WKB to MVT conversion is costly.
